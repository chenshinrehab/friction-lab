<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘©æ“¦åŠ›å¯¦é©—å®¤ï¼šæ‹‰åŠ›å¤§æŒ‘æˆ°</title>
    <style>
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 850px;
            max-width: 95%;
        }

        /* --- å¯¦é©—èˆå° --- */
        .stage-container {
            position: relative;
            width: 100%;
            height: 280px;
            border: 4px solid #333;
            border-radius: 8px;
            overflow: hidden;
            background-color: #e0e0e0;
            margin-bottom: 20px;
        }

        /* åœ°æ¿æè³ª */
        .floor {
            width: 100%;
            height: 100%;
            position: absolute;
            bottom: 0;
            left: 0;
            transition: background 0.5s;
        }
        .floor-ice { background: linear-gradient(to bottom, #e3f2fd 60%, #90caf9 100%); }
        .floor-wood { 
            background: repeating-linear-gradient(45deg, #deb887, #deb887 10px, #d2a679 10px, #d2a679 20px); 
        }
        .floor-sandpaper { 
            background-color: #808080;
            background-image: radial-gradient(#333 15%, transparent 16%);
            background-size: 8px 8px;
        }

        /* æ–¹å¡Š */
        #block {
            width: 100px;
            height: 100px;
            background-color: #e74c3c;
            border: 3px solid #c0392b;
            position: absolute;
            bottom: 20px; /* åœ°æ¿é«˜åº¦ */
            left: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            border-radius: 5px;
            z-index: 2;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
            transition: width 0.3s, height 0.3s, background-color 0.3s;
        }

        /* ç¹©å­èˆ‡æ‹‰åŠ›æŒ‡ç¤º */
        #rope {
            position: absolute;
            height: 4px;
            background-color: #555;
            top: 50%; /* ç›¸å°æ–¼æ–¹å¡Š */
            left: 100%;
            width: 0px;
            transform-origin: left center;
        }
        
        #force-arrow {
            position: absolute;
            right: -10px;
            top: -8px;
            width: 0; 
            height: 0; 
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-left: 15px solid #d35400;
            display: none;
        }

        /* æ‘©æ“¦åŠ›åå‘ç®­é ­ */
        #friction-arrow {
            position: absolute;
            left: -50px;
            bottom: 10px;
            height: 10px;
            background: #27ae60;
            display: flex;
            align-items: center;
            color: white;
            font-size: 12px;
            white-space: nowrap;
            padding-left: 5px;
            transition: width 0.1s;
            opacity: 0;
            z-index: 1;
        }
        #friction-arrow::before {
            content: '';
            position: absolute;
            left: -10px;
            top: -5px;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid #27ae60;
        }

        /* --- æ§åˆ¶é¢æ¿ --- */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .control-group {
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 8px;
        }

        .control-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn-group {
            display: flex;
            gap: 5px;
        }
        .btn {
            flex: 1;
            padding: 8px 5px;
            border: 1px solid #bdc3c7;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .btn:hover { background: #f0f0f0; }
        .btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* æ‹‰åŠ›æ»‘æ¡¿å€åŸŸ */
        .force-control {
            grid-column: 1 / -1;
            background: #d6eaf8;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        input[type=range] {
            width: 80%;
            height: 15px;
            cursor: pointer;
            accent-color: #d35400;
        }

        /* --- å„€è¡¨æ¿ --- */
        .dashboard {
            display: flex;
            justify-content: space-around;
            background: #34495e;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .data-box {
            text-align: center;
        }
        .data-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f1c40f;
        }
        .data-label {
            font-size: 0.8rem;
            color: #bdc3c7;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            background: #95a5a6;
        }
        .status-moving { background: #e74c3c; animation: pulse 1s infinite; }
        .status-static { background: #27ae60; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* é‡ç½®æŒ‰éˆ• */
        .reset-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: 1px solid #333;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 10;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <h1>ğŸšœ æ‘©æ“¦åŠ›å¯¦é©—å®¤ï¼šæ‹‰åŠ›å¤§æŒ‘æˆ°</h1>

    <div class="container">
        
        <div class="stage-container">
            <button class="reset-btn" onclick="resetSim()">ğŸ”„ é‡ç½®ä½ç½®</button>
            <div id="floor" class="floor floor-wood"></div>
            
            <div id="block">
                <span id="weight-text">10kg</span>
                <div id="rope">
                    <div id="force-arrow"></div>
                </div>
                <div id="friction-arrow">æ‘©æ“¦åŠ›</div>
            </div>
        </div>

        <div class="dashboard">
            <div class="data-box">
                <div class="data-label">ç›®å‰ç‹€æ…‹</div>
                <div id="status-display" class="status-badge status-static">éœæ­¢</div>
            </div>
            <div class="data-box">
                <div class="data-label">æ–½åŠ æ‹‰åŠ› (ç‰›é “)</div>
                <div id="pull-val" class="data-value">0 N</div>
            </div>
            <div class="data-box">
                <div class="data-label">æœ€å¤§éœæ‘©æ“¦åŠ› (é–€æª»)</div>
                <div id="max-friction-val" class="data-value">0 N</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="control-title">1. åœ°æ¿æè³ª (ç²—ç³™åº¦)</div>
                <div class="btn-group">
                    <button class="btn" onclick="setMaterial('ice', this)">ğŸ§Š å†°é¢</button>
                    <button class="btn active" onclick="setMaterial('wood', this)">ğŸªµ æœ¨æ¿</button>
                    <button class="btn" onclick="setMaterial('sandpaper', this)">â¬› ç ‚ç´™</button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-title">2. ç‰©é«”é‡é‡ (æ­£å‘åŠ›)</div>
                <div class="btn-group">
                    <button class="btn active" onclick="setWeight(10, this)">10kg</button>
                    <button class="btn" onclick="setWeight(20, this)">20kg</button>
                    <button class="btn" onclick="setWeight(30, this)">30kg</button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-title">3. æ¥è§¸é¢ç©</div>
                <div class="btn-group">
                    <button class="btn active" onclick="setArea('small', this)">å°</button>
                    <button class="btn" onclick="setArea('medium', this)">ä¸­</button>
                    <button class="btn" onclick="setArea('large', this)">å¤§</button>
                </div>
            </div>

            <div class="force-control">
                <div class="control-title" style="font-size: 1.2rem; color: #d35400;">ğŸ‘‡ è«‹æ‹–å‹•æ»‘æ¡¿ä¾†æ–½åŠ› ğŸ‘‡</div>
                <input type="range" id="force-slider" min="0" max="300" value="0" step="1">
            </div>
        </div>

        <div style="background: #e8f6f3; padding: 15px; border-radius: 8px; font-size: 0.9rem; color: #16a085;">
            <strong>ğŸ‘©â€ğŸ« è€å¸«çš„è©±ï¼š</strong>
            <ol style="margin: 5px 0 0 20px;">
                <li>æ…¢æ…¢æ‹‰å‹•æ»‘æ¡¿ï¼Œè§€å¯Ÿæ‹‰åŠ›è¦åˆ°é”å¤šå°‘ï¼Œç‰©é«”æ‰æœƒé–‹å§‹ç§»å‹•ï¼Ÿï¼ˆé€™å°±æ˜¯æœ€å¤§éœæ‘©æ“¦åŠ›ï¼‰</li>
                <li>æŠŠç‰©é«”è®Šé‡ï¼Œéœ€è¦çš„æ‹‰åŠ›æœƒè®Šå¤§å—ï¼Ÿ</li>
                <li><strong>é—œéµæ€è€ƒï¼š</strong>æ”¹è®Šã€Œæ¥è§¸é¢ç©ã€ï¼ˆå¤§/ä¸­/å°ï¼‰ï¼Œéœ€è¦çš„æ‹‰åŠ›æœƒæ”¹è®Šå—ï¼Ÿ</li>
            </ol>
        </div>

    </div>

    <script>
        // DOM å…ƒç´ 
        const block = document.getElementById('block');
        const floor = document.getElementById('floor');
        const weightText = document.getElementById('weight-text');
        const rope = document.getElementById('rope');
        const forceArrow = document.getElementById('force-arrow');
        const frictionArrow = document.getElementById('friction-arrow');
        
        const slider = document.getElementById('force-slider');
        const pullValDisplay = document.getElementById('pull-val');
        const maxFrictionDisplay = document.getElementById('max-friction-val');
        const statusDisplay = document.getElementById('status-display');

        // ç‰©ç†è®Šæ•¸
        let mass = 10;          // kg
        let frictionCoeff = 0.4; // é è¨­æœ¨é ­
        let area = 'small';
        
        let positionX = 50;     // px
        let velocity = 0;
        let pullForce = 0;      // Newtons
        let isMoving = false;
        
        // å¸¸æ•¸ (ç°¡åŒ–ç‰©ç†æ¨¡å‹ g=10)
        const g = 10; 
        
        // æè³ªè¨­å®š
        const materials = {
            ice: { k: 0.1, class: 'floor-ice' },
            wood: { k: 0.4, class: 'floor-wood' },
            sandpaper: { k: 0.8, class: 'floor-sandpaper' }
        };

        // --- è¨­å®šåŠŸèƒ½ ---

        function setMaterial(type, btn) {
            frictionCoeff = materials[type].k;
            floor.className = `floor ${materials[type].class}`;
            updateActiveBtn(btn);
            updatePhysicsState();
        }

        function setWeight(val, btn) {
            mass = val;
            weightText.innerText = val + 'kg';
            
            // è¦–è¦ºä¸Šæ”¹è®Šé¡è‰²æ·±æ·ºä»£è¡¨é‡é‡
            const colors = {10: '#e74c3c', 20: '#c0392b', 30: '#922b21'};
            block.style.backgroundColor = colors[val];
            
            updateActiveBtn(btn);
            updatePhysicsState();
        }

        function setArea(val, btn) {
            area = val;
            // æ”¹è®Šå½¢ç‹€ï¼Œä½†ä¸æ”¹è®Šç‰©ç† (æ‘©æ“¦åŠ›ä¸è®Š)
            if(val === 'small') {
                block.style.width = '60px';
                block.style.height = '140px';
            } else if (val === 'medium') {
                block.style.width = '100px';
                block.style.height = '100px';
            } else {
                block.style.width = '160px';
                block.style.height = '50px';
            }
            updateActiveBtn(btn);
            // æ³¨æ„ï¼šé€™è£¡ä¸å‘¼å« updatePhysicsStateï¼Œå› ç‚ºæ‘©æ“¦åŠ›èˆ‡é¢ç©ç„¡é—œ
        }

        function updateActiveBtn(clickedBtn) {
            // æ‰¾åˆ°åŒå±¤ç´šçš„æ‰€æœ‰æŒ‰éˆ•ç§»é™¤ activeï¼Œå†åŠ çµ¦è¢«é»æ“Šçš„
            const siblings = clickedBtn.parentElement.children;
            for(let btn of siblings) btn.classList.remove('active');
            clickedBtn.classList.add('active');
        }

        // --- ç‰©ç†æ ¸å¿ƒ ---

        function updatePhysicsState() {
            // è¨ˆç®—æœ€å¤§éœæ‘©æ“¦åŠ› = mu * N (N = mass * g)
            const maxFriction = Math.round(frictionCoeff * mass * g);
            maxFrictionDisplay.innerText = maxFriction + " N";
            
            // é€™è£¡åªæœ‰æ›´æ–°é¡¯ç¤ºæ•¸å€¼ï¼Œå¯¦éš›é‹å‹•é‚è¼¯åœ¨ animationLoop
        }

        // ç›£è½æ»‘æ¡¿
        slider.addEventListener('input', (e) => {
            pullForce = parseInt(e.target.value);
            pullValDisplay.innerText = pullForce + " N";
            
            // è¦–è¦ºåŒ–æ‹‰åŠ›ç®­é ­
            if(pullForce > 0) {
                rope.style.width = (50 + pullForce/2) + 'px'; // ç¹©å­æ‹‰é•·
                forceArrow.style.display = 'block';
            } else {
                rope.style.width = '0px';
                forceArrow.style.display = 'none';
            }
        });

        // å‹•ç•«å¾ªç’° (æ¯ä¸€å¹€è¨ˆç®—ä½ç½®)
        let lastTime = performance.now();

        function animate(time) {
            const dt = (time - lastTime) / 1000; // ç§’
            lastTime = time;

            // 1. è¨ˆç®—æ‘©æ“¦åŠ›æ¥µé™
            const maxFriction = frictionCoeff * mass * g;

            // 2. åˆ¤æ–·é‹å‹•ç‹€æ…‹
            // ç°¡åŒ–æ¨¡å‹ï¼šåªè¦ æ‹‰åŠ› > æœ€å¤§æ‘©æ“¦åŠ›ï¼Œå°±é–‹å§‹åŠ é€Ÿ
            // è‹¥ æ‹‰åŠ› <= æœ€å¤§æ‘©æ“¦åŠ›ï¼Œå¦‚æœå·²ç¶“åœ¨å‹•ï¼Œæœƒæœ‰å‹•æ‘©æ“¦åŠ›æ¸›é€Ÿï¼›å¦‚æœéœæ­¢ï¼Œå‰‡ä¸å‹•
            
            let frictionForce = 0;
            let netForce = 0;

            if (isMoving) {
                // å‹•æ‘©æ“¦åŠ› (é€™è£¡å‡è¨­å‹•æ‘©æ“¦ä¿‚æ•¸ = éœæ‘©æ“¦ä¿‚æ•¸ï¼Œé©åˆå°å­¸ç”Ÿ)
                frictionForce = maxFriction;
                
                // å¦‚æœæ‹‰åŠ›å°æ–¼å‹•æ‘©æ“¦åŠ›ï¼Œç‰©é«”æœƒæ¸›é€Ÿ
                netForce = pullForce - frictionForce;
                
            } else {
                // éœæ­¢ç‹€æ…‹
                if (pullForce > maxFriction) {
                    isMoving = true;
                    statusDisplay.innerText = "ç§»å‹•ä¸­ï¼";
                    statusDisplay.className = "status-badge status-moving";
                    // å‰›é–‹å§‹å‹•çš„ä¸€ç¬é–“
                    netForce = pullForce - maxFriction;
                    frictionForce = maxFriction;
                } else {
                    // æ‹‰ä¸å‹•
                    isMoving = false;
                    statusDisplay.innerText = "éœæ­¢";
                    statusDisplay.className = "status-badge status-static";
                    netForce = 0;
                    velocity = 0;
                    frictionForce = pullForce; // éœæ‘©æ“¦åŠ›ç­‰æ–¼æ‹‰åŠ›
                }
            }

            // 3. è¦–è¦ºåŒ–æ‘©æ“¦åŠ› (ç¶ è‰²ç®­é ­)
            if (frictionForce > 0) {
                frictionArrow.style.width = (frictionForce / 2) + 'px'; // æ¯”ä¾‹å°º
                frictionArrow.style.opacity = 1;
            } else {
                frictionArrow.style.opacity = 0;
            }

            // 4. ç‰›é “ç¬¬äºŒé‹å‹•å®šå¾‹ F=ma -> a = F/m
            if (isMoving) {
                const acceleration = netForce / mass;
                velocity += acceleration * dt; // v = v0 + at

                // å¦‚æœé€Ÿåº¦è®Šè² çš„ (ä¾‹å¦‚æ‹‰åŠ›æ”¾æ‰ï¼Œæ‘©æ“¦åŠ›è®“å®ƒåœä¸‹ä¾†)ï¼Œå°±åœæ­¢
                if (velocity < 0) {
                    velocity = 0;
                    isMoving = false;
                }

                // æ›´æ–°ä½ç½® (åŠ ä¸Šåƒç´ æ¯”ä¾‹å°º)
                positionX += velocity * 5; 

                // é‚Šç•Œæª¢æŸ¥
                const containerWidth = document.querySelector('.stage-container').clientWidth;
                const blockWidth = block.offsetWidth;
                
                if (positionX > containerWidth - blockWidth - 10) {
                    positionX = containerWidth - blockWidth - 10;
                    velocity = 0; // æ’ç‰†åœæ­¢
                    // å¼·åˆ¶é‡ç½®æ»‘æ¡¿ï¼Œé¿å…ä¸€ç›´æ’ç‰†
                    // slider.value = 0;
                    // pullForce = 0;
                    // pullValDisplay.innerText = "0 N";
                }
            }

            // æ›´æ–°ç•«é¢
            block.style.left = positionX + 'px';

            requestAnimationFrame(animate);
        }

        function resetSim() {
            positionX = 50;
            velocity = 0;
            isMoving = false;
            slider.value = 0;
            pullForce = 0;
            pullValDisplay.innerText = "0 N";
            rope.style.width = '0px';
            updatePhysicsState();
        }

        // åˆå§‹åŒ–
        setMaterial('wood', document.querySelectorAll('.btn-group')[0].children[1]); // é è¨­ active çš„æŒ‰éˆ•
        setWeight(10, document.querySelectorAll('.btn-group')[1].children[0]);
        setArea('small', document.querySelectorAll('.btn-group')[2].children[0]);
        updatePhysicsState();
        requestAnimationFrame(animate);

    </script>
</body>
</html>
